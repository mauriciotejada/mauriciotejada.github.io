<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcela Perticará y Mauricio Tejada">
<meta name="dcterms.date" content="2020-05-16">

<title>Sobre vulnerabilidad y teletrabajo durante la pandemia – Mauricio M. Tejada</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Mauricio M. Tejada</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html"> 
<span class="menu-text">Curriculum Vitae</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sobre vulnerabilidad y teletrabajo durante la pandemia</h1>
  <div class="quarto-categories">
    <div class="quarto-category">OE-UAH</div>
    <div class="quarto-category">Coyuntura Laboral</div>
    <div class="quarto-category">Pandemia COVID19</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Marcela Perticará y Mauricio Tejada </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 16, 2020</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><em>Publicado en la Revista Observatorio Económico de la Facultad de Economía y Negocios de la Universidad Alberto Hurtado</em></p>
<p>La pandemia del COVID-19 que estamos atravesando representa un evento de proporciones no vistas desde probablemente la gripe española de 1918 y tendrá grandes consecuencias negativas de corto y largo plazo, comparables o incluso más dramáticas de las que tuvo la gran depresión de 1929. Con el objetivo de controlar la pandemia, mediante la reducción de la tasa efectiva de reproducción del virus<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, la recomendación ha sido en todo momento el distanciamiento social. La política de distanciamiento social, altamente efectiva para prevenir los contagios, está impactando de manera agresiva en los trabajadores más vulnerables, forzándolos al desempleo y la pobreza.</p>
<p>Evitar siempre que sea posible actividades con contacto social, con el consumo de servicios y el trabajo presencial, es una respuesta natural de las personas para evitar contagiarse<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. De hecho, cómo lo enfatiza la literatura reciente, muchas personas iniciaron un proceso de distanciamiento social incluso antes que el mismo sea impuesto por la autoridad. En efecto, desde el inicio de la emergencia hasta el 11 de abril, el consumo de actividades con contacto social en Chile (restaurantes, hoteles, cines, gimnasios, aeropuerto, etc.) había caído en casi 75% en promedio, mientras que la concurrencia a farmacias y supermercados, lo había hecho en 50%. (ver Figura 1)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>Los traslados hacia el trabajo también habían caído en 56% hacia el 11 de abril. El primer día de caída importante fue el lunes 16 de marzo, día en que se suspenden las clases en todo el país<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Ya una semana después la movilidad hacia lugares de trabajo había caído un 45-50%, nivel en el que se mantiene, excepto durante el viernes de semana santa. El hecho que el tránsito hacia el trabajo no se haya contraído tanto como otras actividades, sin duda está relacionado con la factibilidad de implementar el completo aislamiento y/o teletrabajo de muchos trabajadores. En muchos casos es simplemente inviable reemplazar el rol del trabajador por teletrabajo.</p>
<p>Desafortunadamente los trabajadores más vulnerables son aquellos cuyos trabajos son fundamentalmente presenciales, y los que no tienen la espalda financiera para enfrentar un período de caída sustantiva de ingresos. Y debiéramos encontrar una alta correlación entre nivel de exposición y nivel socio-económico. Chile no es ajeno a la realidad de otros países. Por ejemplo, la data en Estados Unidos muestra que el Covid-19 está enfermando y matando a la población más vulnerable y a trabajadores de bajo nivel de calificación, fundamentalmente de raza negra. Esto está relacionado directamente con la capacidad de autoaislamiento: el Covid-19 está amplificando inequidades sociales preexistentes y asociadas a raza o etnia, clase social y acceso al sistema de salud.</p>
<p>Fuera de los datos de movilidad hacia el trabajo, hay poca información de quiénes han podido continuar trabajando desde su casa. Según datos de Page Group, entre un 15% y un 20% de los trabajadores en la Región Metropolitana están operando bajo algún tipo de modalidad de trabajo virtual, en áreas de servicios, proveedores de intangibles, áreas comerciales y back office<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Y esta limitación en la información disponible dificulta de manera importante la focalización de recursos públicos para ayudar a las familias y trabajadores más vulnerables.</p>
<p>En ausencia de datos fidedignos de quiénes han podio acogerse a una modalidad de teletrabajo, uno puede evaluar dada la distribución del empleo en el país, en qué medida los distintos trabajadores tendrían la posibilidad de teletrabajar dadas las características de su empleo y en qué medida el tipo de actividad que realizan está exenta de las medidas de aislamiento obligatorio impuesto por el gobierno<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<p>Sólo el 17.4% de los trabajos en Chile son, con alta probabilidad, viables de realizarse desde casa. Las personas que puede de forma viable realizar su trabajo desde casa ganan en promedio 67% más que aquellos que tienen un trabajo predominantemente presencial y tienen una tasa de informalidad sustancialmente menor (11% vs 25%, respectivamente). Solo 1.5% de los trabajadores que pueden realizar su trabajo desde casa son considerados pobres, en tanto que casi el 5% de los trabajadores que no lo pueden hacer son considerados dentro este grupo.</p>
<p>Tal como puede apreciarse en la Figura 2, las mayores tasas de virtualización están en los sectores de administración pública, las actividades inmobiliarias, y enseñanza. En contraste, en los sectores primarios, industrial, gas y agua, industria, construcción, comercio y transporte, las tasas de virtualización son muy bajas. Hay una correlación positiva y fuerte entre tasas de virtualización y calificación de las ocupaciones. Los trabajadores no calificados representan el 25% de aquellos trabajos que no pueden realizarse vía teletrabajo, mientras que para los trabajadores cuyo trabajo es viable de realizarse de esta forma este grupo es sólo 3.7%.</p>
<p>El no poder hacer teletrabajo genera potencialmente una alta exposición en sectores considerados esenciales, como son el sector primario, comercio, gas y agua, transporte y logística y servicios sociales y de salud<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>.</p>
<p>La distribución de los trabajadores (su residencia) con empleos factibles de virtualizarce y de aquellos con alta exposición (no virtualizables y en actividades consideradas esenciales) está altamente concentrada en comunas específicas. En la Figura 3 se gráfica esta distribución geográfica para Región Metropolitana, la región en la que esta mala distribución es fácilmente visible en el mapa. Las comunas de altos ingresos (como Las Condes, Providencia, Vitacura) tienen una alta fracción de empleos virtualizables y una muy baja exposición de los trabajadores ya sea por que el empleo no requiere ser presencial o por que no pertenece a un sector esencial.</p>
<p>La correlación entre una baja factibilidad de realizar teletrabajo, una mayor exposición y menores ingresos crea una navaja de doble filo, esto es crea riesgos económicos y riesgos sanitarios al mismo tiempo para grupos vulnerables de la población (Mongey et. al., 2020). De aquí la importancia de identificar a estos grupos vulnerables. Por un lado, la escasez de recursos pone en relieve la importancia de que la implementación de políticas de reemplazo de ingreso y de inyección de liquidez sea dirigida y focalizada. Evaluar alternativas de ayudas alternativas a grupos de estas comunas parece razonable, por cuanto es necesario impedir que una situación coyuntural pueda cambiar la configuración social de algunos de estos barrios en el largo plazo. Aplicar políticas más generosas, focalizadas sí, pero a grupos más amplios que los tradicionalmente cubiertos por la política pública es necesario en la contingencia actual. Estos trabajadores no pueden darse el lujo de no trabajar si no tienen alguna fuente alternativa de ingresos. Los costos podrán ser altos, pero el riesgo sanitario de no actuar ya para proteger a estos grupos puede ser muy alto.</p>
<p><strong>Referencias</strong> - Jonathan I. Dingel y Brent Neiman (2020): “How Many Jobs Can be Done at Home?”, Mimeo. - Martin S. Eichenbaum, Sergio Rebelo y Mathias Trabandt (2020): “The Macroeconomics of Epidemics”, Mimeo. - Maryam Farboodi, Gregor Jarosch y Robert Shimer (2020): “Internal and External Eﬀects of Social Distancing in a Pandemic”, Mimeo. - Simon Mongey, Laura Pilossoph y Alex Weinberg (2020): “Which workers bear the burden of social distancing policies?”, Mimeo.</p>
<hr>
<p><img src="../images_posts/vulnerabilidad_teletrabajo_pandemia_fig1.png" class="img-fluid"> <img src="../images_posts/vulnerabilidad_teletrabajo_pandemia_fig2.png" class="img-fluid"> <img src="../images_posts/vulnerabilidad_teletrabajo_pandemia_fig3.png" class="img-fluid"></p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Esto es, el número de personas susceptibles que pueden ser contagiadas por una persona infectada.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Ver por ejemplo los trabajos recientes de Farboodi, Jarosch y Shimer (2020) y de Eichenbaum, Rebelo y Trabandt (2020).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Datos de Google Mobility para Chile, a partir de datos anonimizados y agregados de posicionamiento global (GPS) de teléfonos inteligentes.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Notar que los datos están en relación a una línea base que incluye febrero, mes durante el cual muchas personas en Chile están de vacaciones. En la semana previa, en días de semana, la movilidad hacia el lugar del trabajo estaba en un 16-17% por arriba de la línea base, por lo que ya ese lunes 16 la movilidad hacia el trabajo era sensiblemente menor a la estándar.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Datos extraídos de Diario <a href="https://www.latercera.com/pulso/noticia/uno-de-cinco-trabajadores-opera-por-via-remota-la-mayor-parte-en-santiago/G4PCIOVYOFCLTDQ7MO4WWHGMXA/?outputType=amp">La Tercera</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Seguimos la metodología de Dingel y Neiman (2020) que, a partir de la encuesta Occupational Information Network (O*NET) sobre el contexto del trabajo y las actividades laborales de distintas ocupaciones, clasifica la factibilidad de que éstas puedan realizarse vía teletrabajo. Aplicamos esta medida de factibilidad a las ocupaciones de la Encuesta CASEN 2017 usando la clasificación internacional de ocupaciones CIUU88. Para definir sectores de actividad esenciales, usamos el instructivo del Gobierno que puede ser consultado en el siguiente <a href="https://cdn.digital.gob.cl/public_files/Campa%C3%B1as/Corona-Virus/documentos/Instructivo_Desplazamiento_170420.pdf">link</a>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>A sectores como hoteles y restaurantes, construcción y enseñanza, el protocolo establecía que sólo eran esenciales turnos éticos y/o atención en recintos con huéspedes o en predios y obras en los que fuera esencial mantener la actividad. Al no tener suficiente información para clasificar estos sectores, se los omitió de este análisis.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>